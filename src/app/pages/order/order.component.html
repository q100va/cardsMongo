<!--
============================================
 html code to create  orders.
===========================================
-->
<div fxLayout="row" class="main" style="width : 95%;">

    <mat-card class="mat-elevation-z0" style="width : 100%;">
        <div class="wrapper">
            <div class="left" style="padding-left: 30px; padding-right: 8px;">
                <table class="example-full-width" cellspacing="0">
                    <tr>
                        <td>
                            <mat-card-title> Новая заявка </mat-card-title>
                            <mat-card-title> </mat-card-title>
                        </td>
                        <td>
                            <mat-card-actions style="text-align: right; padding-right: px;">
                                <button mat-raised-button (click)="clear()" color="accent">Очистить</button>
                                <button (click)="createOrder()" mat-raised-button color="primary"
                                    [disabled]="!form.valid || clicked">Сформировать</button>
                            </mat-card-actions>
                        </td>
                    </tr>
                </table>

                <p-confirmDialog header="Confirmation" icon="pi pi-exclamation-triangle"
                    [style]="{width: '30%'}"></p-confirmDialog>

                <form [formGroup]="form">
                    <mat-card-content>

                        <div fxLayout="column" fxLayoutGap="10px">
                            <table class="example-full-width" cellspacing="0">
                                <tr>
                                    <td rowspan="2">

                                        <mat-card-subtitle>
                                            Дата: {{orderDate}}</mat-card-subtitle>
                                        <mat-card-subtitle>Координатор: {{userName}} </mat-card-subtitle>
                                        <mat-card-subtitle>Праздник: <span>
                                                <button [disabled]="isBeforeMonth" mat-icon-button
                                                    matTooltip="Предыдущий месяц" color="primary"
                                                    (click)=goBack($event)>
                                                    <mat-icon>navigate_before</mat-icon>
                                                </button>
                                            </span>
                                            <span class="header" *ngIf="!isNextMonth && !isBeforeMonth">{{holiday}}
                                                (21-25
                                                число по умолчанию)</span>
                                            <span class="header" *ngIf="isNextMonth">{{holiday}} (1-5 число по
                                                умолчанию)</span>
                                            <span class="header" *ngIf="isBeforeMonth">{{holiday}} (26-31 число по
                                                умолчанию)</span>
                                            <span>
                                                <button [disabled]="isNextMonth" mat-icon-button
                                                    matTooltip="Следующий месяц" color="primary" (click)=goNext($event)>
                                                    <mat-icon>navigate_next</mat-icon>
                                                </button>
                                            </span>
                                        </mat-card-subtitle>

                                    </td>
                                    <td rowspan="2">

                                    </td>
                                    <td align="left">
                                        <mat-slide-toggle [formControl]="form.controls.isAccepted">Не требует
                                            подтверждения</mat-slide-toggle>
                                    </td>
                                </tr>
                                <tr>

                                    <td align="left">
                                        <mat-form-field>
                                            <mat-label>Источник*</mat-label>
                                            <mat-select [formControl]="form.controls.source">
                                                <mat-option value="subscription">постоянные</mat-option>
                                                <mat-option value="site">сайт фонда</mat-option>
                                                <mat-option value="vk">вконтакте</mat-option>
                                                <mat-option value="telegram">телеграм</mat-option>
                                                <mat-option value="insta">инста</mat-option>
                                                <mat-option value="dobroru">добро ру</mat-option>
                                                <mat-option value="other">другое</mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                        <mat-error class="error"
                                            *ngIf="form.controls.source.hasError('required') && form.controls.source.touched">
                                            Обязательное поле!
                                        </mat-error>
                                    </td>
                                </tr>


                                <tr>
                                    <td>
                                        <h3 class="warning" *ngIf='isBeforeMonth'>ВНИМАНИЕ: это предыдущий месяц!</h3>
                                        <h3 class="warning" *ngIf='isNextMonth'>ВНИМАНИЕ: это следующий месяц!</h3>
                                    </td>
                                </tr>
                            </table>

                            <!--  <h3 class="warning" *ngIf='!showFilter'>Для коллективных заявок фильтры не применяются!</h3> -->
                            <mat-accordion class="example-headers-align">
                                <mat-expansion-panel>
                                    <mat-expansion-panel-header>
                                        <mat-panel-title><!-- matTooltip="Фильтры не работают для коллективных заявок." -->
                                            Фильтры
                                        </mat-panel-title>
                                        <mat-panel-description>

                                        </mat-panel-description>
                                    </mat-expansion-panel-header>

                                    <table class="example-full-width" cellspacing="0">
                                        <tr>
                                            <td width="50%">
                                                <div *ngIf="!form.controls['minNumberOfHouses'].value">

                                                    <label id="example-radio-group-label">Адреса</label>
                                                    <mat-radio-group class="example-radio-group"
                                                        [(ngModel)]="addressFilter"
                                                        [ngModelOptions]="{standalone: true}">
                                                        <mat-radio-button class="example-radio-button" [value]="'any'"
                                                            default (change)="correctMaxNoAddress('any')">
                                                            любые
                                                        </mat-radio-button>
                                                        <mat-radio-button class="example-radio-button"
                                                            [value]="'forKids'"
                                                            (change)="correctMaxNoAddress('forKids')">
                                                            для детей
                                                        </mat-radio-button>

                                                        <mat-radio-button class="example-radio-button"
                                                            [value]="'noSpecial'"
                                                            (change)="correctMaxNoAddress('noSpecial')">
                                                            без БОА
                                                        </mat-radio-button>
                                                        <mat-radio-button class="example-radio-button"
                                                            [value]="'noReleased'"
                                                            (change)="correctMaxNoAddress('noReleased')">
                                                            без бывших з/к
                                                        </mat-radio-button>
                                                        <mat-radio-button class="example-radio-button"
                                                            [value]="'onlySpecial'"
                                                            (change)="correctMaxNoAddress('onlySpecial')">
                                                            только БОА (без з/к)
                                                        </mat-radio-button>
                                                    </mat-radio-group>

                                                    <br />

                                                    <label id="example-radio-group-label">Пол</label>
                                                    <mat-radio-group class="example-radio-group"
                                                        [(ngModel)]="genderFilter"
                                                        [ngModelOptions]="{standalone: true}">
                                                        <mat-radio-button class="example-radio-button" [value]="'any'"
                                                            default (change)="correctProportion('any')">
                                                            любой
                                                        </mat-radio-button>
                                                        <mat-radio-button class="example-radio-button"
                                                            [value]="'Female'" (change)="correctProportion('Female')">
                                                            женщины
                                                        </mat-radio-button>
                                                        <mat-radio-button class="example-radio-button" [value]="'Male'"
                                                            (change)="correctProportion('Male')">
                                                            мужчины
                                                        </mat-radio-button>

                                                        <mat-radio-button class="example-radio-button"
                                                            [value]="'proportion'"
                                                            (change)="correctProportion('proportion')">
                                                            в пропорции </mat-radio-button>
                                                        <div class="example-container" *ngIf="useProportion">
                                                            <mat-form-field style="width: 40%;"
                                                                class="example-user-input" appearance="fill">
                                                                <mat-label>ж</mat-label>
                                                                <input matInput type="number"
                                                                    [formControl]="form.controls['femaleAmount']"
                                                                    placeholder="1" />
                                                            </mat-form-field>

                                                            <mat-form-field style="width: 40%;"
                                                                class="example-user-input" appearance="fill">
                                                                <mat-label>м</mat-label>
                                                                <input matInput type="number"
                                                                    [formControl]="form.controls['maleAmount']"
                                                                    placeholder="1" />
                                                            </mat-form-field>
                                                        </div>
                                                        <mat-error class="error"
                                                            *ngIf="form.controls.femaleAmount.hasError('min') || form.controls.maleAmount.hasError('min') ">
                                                            Введите валидные данные (min 1)!
                                                        </mat-error>

                                                    </mat-radio-group>

                                                    <br />

                                                    <!--                                                 <mat-slide-toggle [formControl]="form.controls['onlyWithPicture']">
                                                    Только с фото</mat-slide-toggle>

                                                <br />
                                                <br /> -->

                                                    <mat-slide-toggle *ngIf="form.controls.onlyWithConcent.value,"
                                                        [formControl]="form.controls['onlyAnniversaries']"
                                                        (change)="onSlideToggleChange('onlyAnniversaries')">
                                                        Только юбиляры</mat-slide-toggle>

                                                    <br />

                                                    <!--<mat-slide-toggle
                                                    [formControl]="form.controls['onlyAnniversariesAndOldest']"
                                                    (change)="onSlideToggleChange('onlyAnniversariesAndOldest')">
                                                    Только юбиляры и 80+</mat-slide-toggle> -->
                                                </div>
                                            </td>
                                            <td>

                                                <h4 *ngIf="!form.controls['minNumberOfHouses'].value"
                                                    matTooltip="Можно указать только одно значение: до или после которого должны быть даты.">
                                                    Даты</h4>

                                                <table class="example-full-width" cellspacing="0">
                                                    <tr *ngIf="!form.controls['minNumberOfHouses'].value">
                                                        <td>

                                                            <mat-form-field class="example-user-input"
                                                                appearance="fill">
                                                                <mat-label>с</mat-label>
                                                                <input matInput type="number"
                                                                    [formControl]="form.controls['date1']"
                                                                    placeholder="6" />
                                                            </mat-form-field>
                                                        </td>
                                                        <td>

                                                            <mat-form-field class="example-user-input"
                                                                appearance="fill">
                                                                <mat-label>по</mat-label>
                                                                <input matInput type="number"
                                                                    [formControl]="form.controls['date2']"
                                                                    placeholder="15" />
                                                            </mat-form-field>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td colspan="2">
                                                            <mat-error class="error"
                                                                *ngIf="form.controls.date1.hasError('min') || form.controls.date2.hasError('min') || form.controls.date1.hasError('max') || form.controls.date2.hasError('max')">
                                                                Введите валидные данные (1-31)!
                                                            </mat-error>
                                                        </td>
                                                    </tr>
                                                </table>

                                                <!-- <h4  *ngIf="showFilter"
                                                    matTooltip="Можно указать только одно значение: до или после которого должен быть год рождения.">
                                                    Год рождения</h4> -->
                                                <!--                                                  <p>
                                                    <span matBadge="i" matBadgeOverlap="false" matTooltip="Info about the action">Год рождения</span>
                                                  </p>  -->

                                                <table class="example-half-width" cellspacing="0">
                                                    <!--                                                     <tr  *ngIf="showFilter">
                                                        <td>

                                                            <mat-form-field class="example-user-input"
                                                                appearance="fill">
                                                                <mat-label>с</mat-label>
                                                                <input matInput type="number"
                                                                    [formControl]="form.controls['year1']"
                                                                    placeholder="1935" />
                                                            </mat-form-field>
                                                        </td>
                                                        <td>

                                                            <mat-form-field class="example-user-input"
                                                                appearance="fill">
                                                                <mat-label>по</mat-label>
                                                                <input matInput type="number"
                                                                    [formControl]="form.controls['year2']"
                                                                    placeholder="1965" />
                                                            </mat-form-field>

                                                        </td>
                                                    </tr>
                                                    <tr  *ngIf="showFilter">
                                                        <td colspan="2">
                                                            <mat-error class="error"
                                                                *ngIf="form.controls.year1.hasError('min') || form.controls.year2.hasError('min') || form.controls.year1.hasError('max') || form.controls.year2.hasError('max')">
                                                                {{"Введите валидные данные (1900-" + actualYear + ")!"}}
                                                            </mat-error>
                                                        </td>
                                                    </tr> -->
                                                    <tr>
                                                        <td colspan="2">
                                                            <h4>Регион <span
                                                                    *ngIf="!form.controls['minNumberOfHouses'].value">(если
                                                                    не работает, введите больший диапазон дат)</span>
                                                            </h4>
                                                            <mat-form-field appearance="fill">

                                                                <mat-select [formControl]="form.controls['region']"
                                                                    (selectionChange)="onChangeRegion()">
                                                                    <mat-option></mat-option>
                                                                    <mat-option *ngFor="let region of regions"
                                                                        [value]="region">
                                                                        {{ region }}
                                                                    </mat-option>
                                                                </mat-select>
                                                            </mat-form-field>
                                                        </td>
                                                    </tr>
                                                    <tr *ngIf="showFilter">
                                                        <td colspan="2">
                                                            <h4>Интернат (если не работает, введите больший диапазон
                                                                дат)</h4>
                                                            <mat-form-field appearance="fill">

                                                                <mat-select [formControl]="form.controls['nursingHome']"
                                                                    (selectionChange)="onChangeNursingHome()">
                                                                    <mat-option></mat-option>
                                                                    <mat-option
                                                                        *ngFor="let nursingHome of activeNursingHomes"
                                                                        [value]="nursingHome.nursingHome">
                                                                        {{ nursingHome.nursingHome }}
                                                                    </mat-option>
                                                                </mat-select>
                                                            </mat-form-field>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td colspan="2">
                                                            <div class="example-container"
                                                                *ngIf="!form.controls['minNumberOfHouses'].value">
                                                                <mat-form-field style="width: 39%;"
                                                                    class="example-user-input" appearance="fill"
                                                                    *ngIf="showMaxOneHouse">
                                                                    <mat-label>max из 1 дома</mat-label>
                                                                    <input matInput type="number"
                                                                        [formControl]="form.controls['maxOneHouse']"
                                                                        placeholder="1" />
                                                                </mat-form-field>

                                                                <mat-form-field style="width: 39%;"
                                                                    class="example-user-input" appearance="fill"
                                                                    *ngIf="showMaxNoAddress">
                                                                    <mat-label>max БОА</mat-label>
                                                                    <input matInput type="number"
                                                                        [formControl]="form.controls['maxNoAddress']"
                                                                        placeholder="1" />
                                                                </mat-form-field>
                                                            </div>
                                                            <mat-error class="error"
                                                                *ngIf="form.controls.maxOneHouse.hasError('min') || form.controls.maxNoAddress.hasError('min') ">
                                                                Введите валидные данные (min 1)!
                                                            </mat-error>
                                                            <mat-checkbox [disabled]="showFilter"
                                                                [formControl]="form.controls['minNumberOfHouses']">с
                                                                минимальным количеством интернатов</mat-checkbox>

                                                            <!--  [disabled]="showFilter" -->
                                                            <mat-checkbox
                                                                [formControl]="form.controls['onlyWithConcent']">только
                                                                с согласиями</mat-checkbox>
                                                        </td>
                                                    </tr>
                                                </table>
                                        </tr>
                                    </table>

                                </mat-expansion-panel>

                            </mat-accordion>
                            <table class="example-full-width" cellspacing="0">


                                <tr>
                                    <td>
                                        <mat-form-field appearance="fill">
                                            <mat-label>Тип контакта*</mat-label>
                                            <mat-select (value)="defaultType"
                                                [formControl]="form.controls['contactType']"
                                                (selectionChange)="getContacts(false)">
                                                <mat-option *ngFor="let type of types" [value]="type">
                                                    {{ type }}
                                                </mat-option>
                                            </mat-select>

                                        </mat-form-field>
                                    </td>
                                    <td>
                                        <mat-form-field appearance="fill">
                                            <mat-label>Email/аккаунт/номер*</mat-label>
                                            <input type="text" matInput [formControl]="form.controls['contact']"
                                                (blur)="checkContactTimeOut()">
                                            <!--                                                 [matAutocomplete]="auto" (blur)="checkContactTimeOut()">
                                            <mat-autocomplete #auto="matAutocomplete">
                                                <mat-option *ngFor="let option of filteredOptions | async"
                                                    [value]="option">
                                                    {{option}}
                                                </mat-option>
                                            </mat-autocomplete> -->
                                        </mat-form-field>
                                    </td>
                                </tr>


                                <tr>
                                    <td>

                                    </td>
                                    <td>
                                        <mat-error class="error"
                                            *ngIf="form.controls.contact.hasError('required') && form.controls.contact.touched">
                                            Обязательное поле!
                                        </mat-error>
                                    </td>

                                </tr>
                                <tr>
                                    <td>
                                        <mat-form-field appearance="fill">
                                            <mat-label>Комментарий</mat-label>
                                            <input type="text" matInput [formControl]="form.controls['comment']" />
                                        </mat-form-field>
                                    </td>
                                    <td>
                                        <mat-form-field appearance="fill">
                                            <mat-label>Количество адресов*</mat-label>
                                            <input type="number" matInput [formControl]="form.controls['amount']" />
                                        </mat-form-field>

                                    </td>

                                </tr>
                                <tr>
                                    <td>
                                    </td>
                                    <td> <mat-error class="error"
                                            *ngIf="form.controls.amount.hasError('required') && form.controls.amount.touched">
                                            Обязательное поле!
                                        </mat-error>

                                        <mat-error class="error" *ngIf="form.controls.amount.hasError('min') ">
                                            Минимум 1 адрес!
                                        </mat-error>
                                    </td>

                                </tr>
                            </table>
                            <table *ngIf="client?.firstName">
                                <tr>
                                    <td colspan="3">
                                        <mat-label>ФИО поздравляющего: {{ client.firstName + " " + (client.patronymic ?
                                            client.patronymic + " ": "") + (client.lastName ? client.lastName + " ":
                                            "") + (client.country ? client.country + " ": "") + (client.region ?
                                            client.region + " ":
                                            "") + (client.city ? client.city: "") + (client.comments ? client.comments :
                                            "")}}</mat-label>
                                        <br /> <br />
                                    </td>
                                </tr>

                                <tr>
                                    <td *ngIf="client.isRestricted">
                                        <h3 class="warning">Внимание! Ограничения!</h3>

                                        <div>
                                            Причина: {{client.causeOfRestriction }}

                                        </div>
                                        <div>
                                            Меры: {{client.preventiveAction }}
                                        </div>
                                        <br />
                                    </td>
                                </tr>



                                <tr>
                                    <td colspan="3">
                                        <mat-label>Адреса для коллектива:</mat-label>
                                        <br /> <br />
                                    </td>
                                </tr>

                                <tr formArrayName="institutes" *ngFor="let item of institutes.controls; index as i">

                                    <td colspan="3">
                                        <p><mat-checkbox [formControlName]="i"
                                                (change)="checkInstitutes()">{{clientInstitutes[i].name}}
                                            </mat-checkbox></p>
                                    </td>

                                </tr>
                                <tr>

                                    <td width="40%">
                                        <mat-form-field>
                                            <input type="text" matInput [formControl]="form.controls['nameOfInstitute']"
                                                [placeholder]="'Организация*'" />

                                        </mat-form-field>

                                    </td>
                                    <td width="30%">
                                        <mat-form-field>
                                            <mat-label>Категория*</mat-label>
                                            <mat-select [formControl]="form.controls['categoryOfInstitute']">
                                                <mat-option></mat-option>

                                                <mat-option *ngFor="let category of categories" [value]="category">
                                                    {{ category }}
                                                </mat-option>
                                            </mat-select>

                                            <br />
                                        </mat-form-field>
                                    </td>
                                    <td width="10%">
                                        <button mat-button (click)="saveInstitute()"
                                            [disabled]="!form.controls.nameOfInstitute.value || !form.controls.categoryOfInstitute.value">Сохранить</button>
                                    </td>


                                </tr>
                                <tr>
                                    <td colspan="3">
                                        <mat-hint>При необходимости добавьте новую организацию. Обязательно заполните
                                            оба поля и нажмите "Сохранить".</mat-hint>
                                    </td>
                                </tr>

                            </table>



                        </div>

                    </mat-card-content>

                </form>
            </div>
            <div class="right" style="padding-left: 30px; padding-right: 30px;">
                <table class="example-full-width" cellspacing="0">
                    <tr>
                        <td>
                            <mat-card-title> Список поздравляемых {{contactReminder}}</mat-card-title>
                            <!--<mat-card-actions>
                    <button mat-raised-button (click)="clear()" color="primary"
                        [disabled]="!form.valid">Очистить</button>
                    <button (click)="createOrder()" mat-raised-button color="accent"
                        [disabled]="!canSave">Сохранить</button>
                </mat-card-actions> -->
                            <p style="color: rgb(255, 0, 0); font-weight: bold; ">{{errorMessage}}</p>
                            <p style="color: rgb(101, 80, 219); font-weight: bold; ">{{successMessage}}</p>


                        </td>
                        <td width="10%">
                            <button mat-fab matTooltip="Скопировать" color="primary" [disabled]="lineItems.length == 0"
                                (click)="getAddresses()">
                                <mat-icon>file_copy</mat-icon>
                            </button>
                        </td>
                        <!--                         <td width="10%">
                            <button *ngIf="isAdmin" mat-fab matTooltip="Отправить с Яндекс почты" color="white"
                                (click)="sendEmail('yandex')">
                                <mat-icon svgIcon="yandex"></mat-icon>

                            </button>
                        </td>
                        <td width="10%">
                            <button *ngIf="isAdmin" mat-fab matTooltip="Отправить с Google почты" color="white"
                                (click)="sendEmail('google')">
                                <mat-icon svgIcon="google"></mat-icon>
                            </button>
                        </td> -->

                    </tr>
                    <tr>
                        <td colspan="2" style="padding-bottom: 20px;">
                            <span *ngIf="lineItems.length > 0">
                                <mat-slide-toggle [(ngModel)]="showIndexes">пронумеровать</mat-slide-toggle>
                            </span>
                        </td>
                    </tr>


                    <tr>
                        <td colspan="2">
                            <span *ngIf="lineItems.length > 0">
                                <mat-slide-toggle [(ngModel)]="showInstruction"
                                    (change)="onSlideToggleChangeInstruction('newMember')">с памяткой для
                                    новеньких</mat-slide-toggle>
                            </span>
                        </td>

                    </tr>
                    <tr>

                        <td colspan="2">
                            <span *ngIf="lineItems.length > 0">
                                <mat-slide-toggle [(ngModel)]="showInstructionForSubscribers"
                                    (change)="onSlideToggleChangeInstruction('subscriber')">с текстом для
                                    постоянных</mat-slide-toggle>
                            </span>
                        </td>
                    </tr>


                </table>

                <br /><br />
                <div style="width: 100%;">
                    <div>
                        <mat-spinner mode="indeterminate" *ngIf="spinner" style="margin:40px auto ;"></mat-spinner>
                    </div>
                </div>

                <section *ngIf="lineItems.length > 0">

                    <mat-card-content *ngIf="showInstructionForSubscribers && !isForInstitutes"
                        style="font-family: 'Times New Roman', Times, serif; font-size: 1em; line-height: 1.5em; width: 100%;">

                        <p *ngIf="clientFirstName" style="font-family: 'Times New Roman', Times, serif;">Приветствую
                            вас,
                            {{clientFirstName}}!</p>
                        <p *ngIf="!clientFirstName || clientFirstName == 'Волонтер'"
                            style="font-family: 'Times New Roman', Times, serif;">
                            Приветствую вас!</p>

                        <!--            Сроки доставки писем в настоящее время, к сожалению, предсказать невозможно.<br />
                            Некоторые интернаты сообщают, что корреспонденция опаздывает на 2-3 недели,а где-то больше,
                            чем на месяц. На конверте рекомендуем сделать пометку "прошу вручить <дата>".<br /><br /> -->

                        <p style="font-family: 'Times New Roman', Times, serif; font-style: italic;">
                            Большое вам спасибо за отклик!<br />
                            Просим вас учитывать, что почтовые тарифы повышены с 10 февраля 2025 г.<br />
                            Открытки нужно отправить примерно за месяц до праздника или дня рождения.
                            <span *ngIf="!onlyWithConcent"> Для определения сроков отправки ориентируйтесь на даты,
                                указанные в заголовке.</span><br />
                            Обязательно <strong>сообщите нам, если кто-то из поздравляемых вам ответит: не вступайте в
                                переписку без предварительного согласования</strong> с координатором.<br />
                            Не отправляйте подарки, сувениры, гостинцы, регистрируемые письма, бандероли, посылки.

                        </p>
                        <!--                              Обращаю ваше внимание, что списки поздравляемых идут без фамилий и без точных дат
                                (теперь мы
                                получаем только такие данные).<br />
                                Не переживайте:<br />
                                - в интернате точно найдут поздравляемого и вручат ему открытку;<br />
                                - открытки и конверты без фамилии, а только с именем и отчеством на почте принимают и
                                доставляют.<br /> -->

                        <h2 style="font-family: 'Times New Roman', Times, serif; font-weight: bold;">
                            {{isForInstitutes ? holiday : holidayTitle }}
                        </h2>
                    </mat-card-content>

                    <mat-card-content *ngIf="showInstruction"
                        style="font-family: 'Times New Roman', Times, serif; font-size: 1em; line-height: 1.5em; width: 100%;">

                        <p *ngIf="clientFirstName" style="font-family: 'Times New Roman', Times, serif;">Добрый день,
                            {{clientFirstName}}!</p>
                        <p *ngIf="clientFirstName == null || ''" style="font-family: 'Times New Roman', Times, serif;">
                            Добрый день!</p>


                        <p
                            style="font-weight: 600; color: rgb(255, 0, 0); font-family: 'Times New Roman', Times, serif;">
                            Пожалуйста, подтвердите получение этого письма, ответив на него!
                        </p>

                        <p style="font-family: 'Times New Roman', Times, serif;">
                            Мы получили вашу заявку и очень рады вашему участию!
                        </p>
                        <!--                         Иногда в списках встречаются
                        люди, которых к престарелым совсем не относятся. Это инвалиды, которые
                        проживают в домах престарелых. Иногда сразу после детдомов. -->

                        <!--                 <p *ngIf="!onlyWithConcent" style="font-family: 'Times New Roman', Times, serif;">
                            Высылаю вам адреса для поздравления жителей домов престарелых (сначала
                            идет адрес, потом - ИО или несколько ИО). Фамилии в списках не указаны.
                        </p>

                        <p *ngIf="onlyWithConcent" style="font-family: 'Times New Roman', Times, serif;">
                            Высылаю вам адреса для поздравления жителей домов престарелых (сначала
                            идет адрес, потом - ФИО или несколько ФИО).
                        </p>
 -->

                        <h2 style="font-family: 'Times New Roman', Times, serif; font-weight: bold;">
                            {{isForInstitutes ? holiday : holidayTitle }}
                        </h2>

                        <p
                            style="font-style: italic; font-family: 'Times New Roman', Times, serif; font-size: 0.9em; line-height: 1.2m;">
                            Если какие-то адреса вам не подходят, обязательно возвращайте -
                            заменю.<br />
                            Если вы не сможете отправить открытки, сообщите мне, как можно скорее,
                            чтобы я могла их передать другому поздравляющему.
                        </p>
                        <!-- <br />
                            Обращаю ваше внимание, что по полученным адресам нужно отправить открытки и только открытки
                            один раз к указанному празднику. Письма писать не нужно!<br />
                            Для поздравления с другими праздниками нужно получать другие адреса. Списки на поздравления
                            мы готовим примерно за 3
                            месяца до праздника. -->
                        <p *ngIf="!onlyWithConcent"
                            style="font-family: 'Times New Roman', Times, serif; font-weight:bold; text-decoration: underline;
                            text-decoration-color: rgb(31, 86, 168); color: rgb(31, 86, 168);">
                            Сначала идет адрес, потом - ИО или несколько ИО. Фамилии в списках не указаны.
                        </p>

                        <p *ngIf="onlyWithConcent"
                            style="font-family: 'Times New Roman', Times, serif;; font-weight:bold; text-decoration: underline;
                            text-decoration-color: rgb(31, 86, 168); color: rgb(31, 86, 168);">
                            Сначала идет адрес, потом - ФИО или несколько ФИО.
                        </p>

                    </mat-card-content>

                    <mat-card-content *ngIf="showInstructionForSubscribers && isForInstitutes"
                        style="font-family: 'Times New Roman', Times, serif; font-size: 1em; line-height: 1.5em; width: 100%;">

                        <p *ngIf="clientFirstName" style="font-family: 'Times New Roman', Times, serif;">Добрый день,
                            {{clientFirstName}}!</p>
                        <p *ngIf="clientFirstName == null || ''" style="font-family: 'Times New Roman', Times, serif;">
                            Добрый день!</p>

                        <p style="font-family: 'Times New Roman', Times, serif; font-style: italic;">
                            Большое вам спасибо за отклик!<br />
                            Рассчитывайте, что срок доставки будет примерно 30 дней.<br />
                            Обязательно <strong>сообщите нам, если кто-то из поздравляемых вам ответит: не вступайте в
                                переписку без предварительного согласования</strong> с координатором.<br />
                            Не отправляйте подарки, сувениры или гостинцы.
                        </p>

                        <p style="font-family: 'Times New Roman', Times, serif; font-style: italic;">
                            Если вам удобнее, то в один интернат можно отправить все открытки одной ПРОСТОЙ бандеролью.
                            Получателем указать интернат. На конверте рекомендуем указать название праздника. Например,
                            'Дни рождения апреля'.
                            Часто работники почты уговаривают отправителей на регистрируемые отправления (заказные,
                            ценные, первого класса), но нам такой вариант совершенно не подходит,
                            так как такие отправления с 99% вероятностью вернутся обратно.
                        </p>
                        <!--       <a href="https://disk.yandex.ru/i/pIc9B0o9HKXGrQ">Ссылка на полную инструкцию</a> -->
                        <br /> <br />

                        <h2 *ngIf="isForInstitutes"
                            style="font-family: 'Times New Roman', Times, serif; font-weight: bold;">
                            {{ holiday }}
                        </h2>
                        <h2 *ngIf="!isForInstitutes"
                            style="font-family: 'Times New Roman', Times, serif; font-weight: bold;">
                            {{ holidayTitle }}
                        </h2>
                    </mat-card-content>

                    <!--                  <mat-card-content *ngIf="showInstruction && isForInstitutes"
                        style="font-family: 'Times New Roman', Times, serif; font-size: 1em; line-height: 1.5em; width: 100%;">

                        <p *ngIf="clientFirstName" style="font-family: 'Times New Roman', Times, serif;">Добрый день,
                            {{clientFirstName}}!</p>
                        <p *ngIf="clientFirstName == null || ''" style="font-family: 'Times New Roman', Times, serif;">
                            Добрый день!</p>


                        <p
                            style="font-weight: 600; color: rgb(255, 0, 0); font-family: 'Times New Roman', Times, serif;">
                            Пожалуйста, подтвердите получение этого письма, ответив на него!
                        </p>

                        <p style="font-family: 'Times New Roman', Times, serif;">
                            Мы получили вашу заявку и очень рады вашему участию!
                        </p>

                        <p style="font-family: 'Times New Roman', Times, serif;">
                            В правила поздравления были внесены изменения, поэтому сообщаю вам только адреса интернатов
                            и количество поздравляемых, то есть открытки будут не именные.<br />
                            Открытки нужно будет отправить ПРОСТОЙ бандеролью на адрес интерната через Почту России.
                            НЕ заказной, НЕ ценной, НЕ первого класса и никакой другой регистрируемой.
                            Потому что простую бандероль почтальон приносит в интернат, а за регистрируемыми
                            отправлениями нужно идти на почту с доверенностью.
                            Правда, к сожалению, простая бандероль не имеет трек номера и ее нельзя отследить.<br />
                            То есть все открытки нужно упаковать в один почтовый пакет (или конверт), заполнить адресную
                            часть и отнести на почту, там отправить ПРОСТУЮ бандероль через оператора.
                            Если вес будет менее 100 г, то отправление оформят как простое письмо с доплатой за вес.
                            Часто работники почты уговаривают отправителей на заказные или ценные бандероли, говорят,
                            что это быстрее и надежнее, но нам такой вариант совершенно не подходит, так как такие
                            отправления с 99% вероятностью вернутся обратно.

                        </p>

                        <h2 style="font-family: 'Times New Roman', Times, serif; font-weight: bold;">
                            {{ holiday }}
                        </h2>

                        <p
                            style="font-style: italic; font-family: 'Times New Roman', Times, serif; font-size: 0.9em; line-height: 1.2m;">
                            Если какие-то адреса вам не подходят, обязательно возвращайте -
                            заменю.<br />
                            Если вы не сможете отправить открытки, сообщите мне, как можно скорее,
                            чтобы я могла их передать другому поздравляющему.<br />
                            Обращаю ваше внимание, что по полученным адресам нужно отправить открытки и только открытки
                            один раз к указанному празднику. Письма писать не нужно!<br />
                            Для поздравления с другими праздниками нужно получать другие адреса. Списки на поздравления
                            мы готовим примерно за 3
                            месяца до праздника.
                        </p>


                    </mat-card-content>-->
               
                    <mat-card-content *ngFor="let lineItem of lineItems">

                        <p style="font-weight: bold; margin: 0; font-family: 'Times New Roman', Times, serif;">
                            {{lineItem.address}}</p>
                        <p style="font-style: italic; margin: 0; font-family: 'Times New Roman', Times, serif;"
                            *ngIf="lineItem.infoComment">
                            {{lineItem.infoComment}}
                        </p>
                        <p style="color: red; font-weight: bold; margin: 0; font-family: 'Times New Roman', Times, serif;"
                            *ngIf="lineItem.adminComment">
                            {{lineItem.adminComment}}</p>
                        <!--                    <p *ngIf="isForInstitutes"
                            style="font-weight: bold; margin: 0; font-family: 'Times New Roman', Times, serif;">
                            {{lineItem.celebrators.length}} откр.: {{lineItem.Female}} жен. + {{lineItem.Male}} муж.</p> -->

                        <!--  <section *ngIf="!isForInstitutes"> -->
                        <div *ngFor="let celebrator of lineItem.celebrators"
                            style="font-family: 'Times New Roman', Times, serif;">

                            <!--   <mat-icon font-size="1px">brightness_1</mat-icon> 
                        {{lineItems.indexOf(lineItem)*2 + lineItem.celebrators.indexOf(celebrator)+1}}<span>. </span>-->
                            <span *ngIf="showIndexes">{{celebrator.index}}. </span>
                            <span
                                *ngIf="onlyWithConcent && celebrator.dateOfSignedConsent">{{celebrator.lastName}}</span>
                            {{celebrator.firstName}}
                            {{celebrator.patronymic}}
                            <span
                                *ngIf="onlyWithConcent && celebrator.dateOfSignedConsent">{{celebrator.fullDayBirthday}}</span>
                            {{celebrator.comment1}}
                            <span
                                *ngIf="onlyWithConcent && celebrator.dateOfSignedConsent">{{celebrator.linkPhoto}}</span>
                            <span *ngIf="onlyWithConcent && celebrator.dateOfSignedConsent"
                                style="font-weight: bold; color: rgb(175, 19, 175); ">
                                {{celebrator.specialComment}}
                            </span>
                        </div>
                        <!--             </section> -->
                        <br />
                    </mat-card-content>


                    <mat-card-content *ngIf="showInstructionForSubscribers">

                        <p
                            style="font-family: 'Times New Roman', Times, serif; font-size: 1em; line-height: 1.5em; width: 100%;">
                            Благодарю вас многократно! <br />
                            _________________________________________________<br />
                            Поучаствуйте в сборе на семена, чтобы жители интернатов смогли вырастить рассаду, <a
                                href="https://starikam.org/campaign/kupim-semena-u-starshix-budet-delo/">здесь</a>.
                        </p>


                    </mat-card-content>



                    <mat-card-content *ngIf="showInstruction"
                        style="font-family: 'Times New Roman', Times, serif; font-size: 1em; line-height: 1.5em; width: 100%; ">

                        <h3
                            style="font-family: 'Times New Roman', Times, serif; font-weight: bold; color: rgb(31, 86, 168)">
                            Отправляйте письма правильно!</h3>
                        <ul>
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                Открытки отправляйте Почтой России только ПРОСТЫМИ письмами/открытками
                                (НЕ заказными).
                            </li>

                            <li style="font-family: 'Times New Roman', Times, serif;">
                                Каждому адресату отправляйте отдельную открытку в отдельном конверте
                                или отдельную почтовую открытку без конверта.
                            </li>
                            <li *ngIf="isForInstitutes" style="font-family: 'Times New Roman', Times, serif;">
                                Если вам удобнее, то в один интернат можно отправить все открытки одной ПРОСТОЙ
                                бандеролью. Получателем указать интернат. На конверте рекомендуем указать название
                                праздника. Например, "Дни рождения апреля".
                            </li>
                            <li style="font-family: 'Times New Roman', Times, serif;" *ngIf="isForInstitutes">
                                Рассчитывайте, что срок доставки будет примерно 30 дней.
                            </li>
                            <li style="font-family: 'Times New Roman', Times, serif;" *ngIf="!isForInstitutes">
                                Рассчитывайте, что срок доставки будет примерно 30 дней. <span
                                    *ngIf="!onlyWithConcent">Для определения сроков отправки
                                    ориентируйтесь на даты, указанные в заголовке.</span>
                            </li>
                        </ul>

                        <!--                         <ul *ngIf="isForInstitutes">
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                Открытки отправляйте Почтой России только ПРОСТЫМИ бандеролями (от 100 г до 5 кг) или
                                ПРОСТЫМИ письмами (до 100 г).
                            </li>
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                Рассчитывайте, что срок доставки будет примерно 30 дней.
                            </li>
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                В графе "кому" указывайте название интерната (учреждения). Указывать ФИО получателя
                                совершенно не обязательно.
                            </li>
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                На конверте/пакете укажите название праздника/праздников, особенно это актуально для
                                дней рождений. (Например, "дни рождения декабря").
                            </li>
                        </ul> -->

                        <h3
                            style="font-family: 'Times New Roman', Times, serif; font-weight: bold; color: rgb(31, 86, 168)">
                            Как писать поздравления?</h3>
                        <ul>
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                Используйте обращение на "Вы" и по имени-отчеству (если отчество
                                указано).
                            </li>
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                Пишите поздравления от себя лично (не от организации, не от школы, не
                                от фонда).
                            </li>
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                Подпишитесь своим именем, укажите город и добавьте пару слов о себе.
                            </li>
                            <li style="font-family: 'Times New Roman', Times, serif;">По возможности укажите ваш
                                обратный адрес (кроме случаев, когда мы просим этого не делать)*.
                            </li>
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                Адрес и данные получателя на конверте или почтовой открытке укажите обязательно в правом
                                нижнем
                                углу.
                            </li>
                        </ul>

                        <!--                   <ul *ngIf="isForInstitutes">
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                Начните ваше поздравление с приветствия: "Добрый день! Поздравляю Вас..." или
                                "Здравствуйте! Поздравляю Вас...".

                            </li>
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                В поздравлениях с днями рождения можно использовать обращения: "Дорогая именинница!",
                                "Уважаемый именинник!".

                            </li>
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                Обязательно используйте обращение на "Вы".

                            </li>
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                Не используйте такие обращения, как "дедушка" или "бабушка": в интернатах проживают и
                                молодые люди - инвалиды.
                            </li>
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                Пишите поздравления от себя лично (не от организации, не от школы, не
                                от фонда).
                            </li>
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                Подпишитесь своим именем, укажите город и добавьте пару слов о себе.
                            </li>

                        </ul> -->

                        <h3
                            style="font-family: 'Times New Roman', Times, serif; font-weight: bold; color: rgb(31, 86, 168)">
                            Что писать не надо.</h3>
                        <ul>
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                Не желайте семейного уюта, любви близких, финансового благополучия и
                                т.п.
                            </li>
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                Нигде не указывайте ваш телефон (даже, если есть такое поле на конверте), если не готовы
                                на 200%, что вам начнут звонить и писать в любое время.
                            </li>
                            <!--    <li *ngIf="isForInstitutes" style="font-family: 'Times New Roman', Times, serif;">
                                Нигде в открытке (или на конверте, если каждая открытка в конверте) не указывайте ваш
                                телефон, если не готовы на 200%, что вам начнут звонить и писать в любое время.
                            </li> -->
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                Если написано, что поздравления нужно отправлять без указания обратного адреса, не
                                давайте
                                свой обратный адрес и любые другие контакты*.
                            </li>
                        </ul>

                        <h3
                            style="font-family: 'Times New Roman', Times, serif; font-weight: bold; color: rgb(31, 86, 168)">
                            Получили ответ?</h3>
                        <ul>
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                Если получили ответ от жителя интерната, обязательно сообщите об этом
                                нам.
                            </li>
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                Не вступайте в переписку с ответившим до того, как это будет
                                согласовано с координатором.
                            </li>
                            <li style="font-family: 'Times New Roman', Times, serif;">Если ваше отправление вернулось,
                                также сообщите нам.</li>
                        </ul>

                        <h3
                            style="font-family: 'Times New Roman', Times, serif; font-weight: bold; color: rgb(31, 86, 168)">
                            Чего просим не делать.</h3>
                        <ul>
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                Запрещены любые публикации (в соцсетях, на сайтах учебных заведений,
                                на личных страницах и т.д.) адресов и/или ФИО наших подопечных (в т.ч.
                                фото конвертов или открыток, на которых указаны адрес и/или ФИО
                                подопечного).
                            </li>
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                Не отправляйте подарки, сувениры и гостинцы, чтобы не омрачить
                                праздник других людей.
                            </li>
                            <!--                        <li *ngIf="!isForInstitutes" style="font-family: 'Times New Roman', Times, serif;">
                                Не отправляйте посылки, бандероли, заказные/ценные письма, письма
                                первого класса и прочие регистрируемые отправления, так как возможны
                                проблемы с получением подобной корреспонденции и ваше отправление
                                может вернуться.
                            </li> -->
                            <li style="font-family: 'Times New Roman', Times, serif;">
                                Не отправляйте посылки, заказные/ценные бандероли, заказные/ценные письма, письма и
                                бандероли
                                первого класса и прочие регистрируемые отправления, так как возможны
                                проблемы с получением подобной корреспонденции и ваше отправление
                                может вернуться.
                            </li>
                            <!--                             <li style="font-family: 'Times New Roman', Times, serif;">
                                По указанным адресам нужно отправить открытки только один раз: не нужно поздравлять
                                людей со всеми праздниками или писать им письма!
                            </li> -->
                        </ul>
                        <p style="font-weight: bold; font-family: 'Times New Roman', Times, serif;">
                            Поучаствуйте в сборе на семена, чтобы жители интернатов смогли вырастить рассаду - <a
                                href="https://starikam.org/campaign/kupim-semena-u-starshix-budet-delo/">starikam.org</a>
                        </p>
                        <hr />
                        <p style="font-weight: bold; font-family: 'Times New Roman', Times, serif;">
                            Огромное вам спасибо за радость для наших подопечных! <br />
                            Будут вопросы — обращайтесь!
                        </p>
                        <br />
                        <p style="font-family: 'Times New Roman', Times, serif; font-style: italic;">* - Мы просим
                            отправлять без указания обратного адреса поздравления в психоневрологические интернаты (ПНИ)
                            и
                            специальные интернаты по настоятельной просьбе администрации этих учреждений, чтобы их
                            жители не
                            потревожили поздравляющих ответными письмами. Если в вашем списке есть такой адрес, то под
                            ним
                            обязательно идет соответствующий комментарий:
                            <span style="color: rgb(255, 0, 0);"> (администрация настоятельно просит не указывать ваш
                                личный
                                адрес на отправлениях в этот
                                интернат, в графе откуда укажите адрес вашего почтового отделения, в графе от кого –
                                Волонтер и ваше имя)</span>.
                            Если такого комментария нет, то можете указать свой личный адрес.
                        </p>
                    </mat-card-content>

                </section>
            </div>
        </div>
    </mat-card>
</div>




<!-- <h3>Angular Material Select with Search</h3>
<form [formGroup]="bookForm" (ngSubmit)="onFormSubmit()" class="book-form">
  <mat-form-field class="select-book">
    <input type="text" placeholder="Email" matInput formControlName="book" [matAutocomplete]="auto">
    <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn">
      <mat-option *ngFor="let book of $filteredBooks | async" [value]="book">
        {{book.name}}
      </mat-option>
    </mat-autocomplete>
  </mat-form-field>

  <mat-form-field>
    <input type="text" matInput [formControl]="bookForm.controls['lastName']" placeholder="Другой контакт"
       />
  </mat-form-field>
  <mat-form-field>
    <input type="text" matInput [formControl]="bookForm.controls['lastName']" placeholder="Другой контакт"
       />
  </mat-form-field>

  <br/>
  <br/>
  <button mat-raised-button>Submit</button>
  <button mat-raised-button type="button" (click)="resetForm()">Reset</button>
</form>  -->